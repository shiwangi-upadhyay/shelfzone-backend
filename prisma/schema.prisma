generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPER_ADMIN
  HR_ADMIN
  MANAGER
  EMPLOYEE
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
  TERMINATED
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String   @map("password_hash")
  role          Role     @default(EMPLOYEE)
  isActive      Boolean  @default(true) @map("is_active")
  refreshToken  String?  @map("refresh_token")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  employee         Employee?
  managedDepartments Department[] @relation("DepartmentManager")

  @@map("users")
}

model Department {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  managerId   String?  @map("manager_id")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  manager   User?      @relation("DepartmentManager", fields: [managerId], references: [id])
  employees Employee[]

  @@map("departments")
}

model Designation {
  id          String   @id @default(cuid())
  title       String   @unique
  level       Int
  description String?
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  employees Employee[]

  @@map("designations")
}

model Employee {
  id              String         @id @default(cuid())
  employeeCode    String         @unique @map("employee_code")
  userId          String         @unique @map("user_id")
  departmentId    String         @map("department_id")
  designationId   String         @map("designation_id")
  firstName       String         @map("first_name")
  lastName        String         @map("last_name")
  phone           String?
  encryptedAadhaar String?       @map("encrypted_aadhaar")
  encryptedPan     String?       @map("encrypted_pan")
  encryptedSalary  String?       @map("encrypted_salary")
  dateOfJoining   DateTime       @map("date_of_joining")
  dateOfLeaving   DateTime?      @map("date_of_leaving")
  status          EmployeeStatus @default(ACTIVE)
  managerId       String?        @map("manager_id")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  // Relations
  user          User        @relation(fields: [userId], references: [id])
  department    Department  @relation(fields: [departmentId], references: [id])
  designation   Designation @relation(fields: [designationId], references: [id])
  manager       Employee?   @relation("EmployeeHierarchy", fields: [managerId], references: [id])
  directReports Employee[]  @relation("EmployeeHierarchy")

  @@map("employees")
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?  @map("user_id")
  action     String
  resource   String
  resourceId String?  @map("resource_id")
  details    Json?
  ipAddress  String?  @map("ip_address")
  userAgent  String?  @map("user_agent")
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("audit_logs")
}
